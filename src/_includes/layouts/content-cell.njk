{# layouts/content-cell.njk â€” stabilized thin executor #}

{% set wrapper = cell.wrapper %}
{% set isStack = cell.includes and (cell.includes | length) > 1 %}
<div class="content-cell{% if isStack %} content-cell--stack{% endif %}" data-cell="{{ wrapper }}">
  {% if cell.includes and (cell.includes | length) %}
    {% for item in cell.includes %}
      {% if item.include %}
        {% if not item.params %}
            <!-- EXECUTOR_ERROR: missing params for {{ item.include }} -->
        {% endif %}
      {% set params = item.params %}

        {# Chapter label injection (Header) #}
        {% set id = params.id %}
        {% if sectionTitleId
          and pageItemIndex0 == 0
          and cellIndex0 == 0
          and loop.index0 == 0
          and item.include == "components/header.njk"
        %}
          {% set id = sectionTitleId %}
        {% endif %}

        {# Single include switch (exactly once) #}
        {% if item.include == "components/figure.njk" %}
          {% set figureParams = params %}
          {% include item.include %}

        {% elseif item.include == "components/header.njk" %}
          {% set headerParams = params %}
          {% set headerParamsId = id %}
          {% include item.include %}

        {% elseif item.include == "components/link-block.njk" %}
          {% set linkBlockParams = params %}
          {% include item.include %}

        {% elseif item.include == "components/richtext.njk" %}
          {% set richtextParams = params %}
          {% include item.include %}

        {% else %}
            <!-- UNKNOWN_INCLUDE:
                include={{ item.include }}
                route={{ page.url }}
                section={{ sectionTitleId }}
                pageIndex={{ pageItemIndex0 }}
                cellIndex={{ cellIndex0 }}
            -->
        {% endif %}

      {% endif %}
    {% endfor %}
  {% endif %}
</div>
